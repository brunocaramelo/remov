---

- name: Install MySQL
  hosts: all
  tasks:
    - name: update yum
      yum: name=* state=latest

    #- name: Install Mysql Pack.
    #  raw: wget http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm && rpm -Uvh  mysql57-community-release-el7-8.noarch.rpm
    #  changed_when: False
    - name: Download Mysql
      copy: src=./dep/mysql57-community-release-el7-8.noarch.rpm
            dest=/tmp/mysql57-community-release-el7-8.noarch.rpm
            mode=077
  
    - name: Ensure a list of packages installed
      yum:
        name: "{{ packages }}"
      vars:
        packages:
          - MySQL-python
        state: present
        update_cache: yes

   
- name: Configure MySQL
  hosts: mysql-service
  tasks:
    - name: Configure my.cnf
      copy: src=./files/my.cnf
            dest=/etc/mysql/my.cnf
            owner=root
            group=root
            mode=0640
      notify:
        - restart mysql
    
    - name: Add mysql-user
      mysql_user: name=mysql_service
                  password=passwordMysqlSecret
                  priv=*.*:ALL
                  state=present
      notify:
        - start mysql

  handlers:
    - name: start mysql
      service: name=mysql
               enabled=yes
               state=started
    - name: restart mysql
      service: name=mysql
               enabled=yes
               state=restarted



# /sbin/iptables -A INPUT -i eth0 -s 192.168.33.0/24 -p tcp --destination-port 3306 -j ACCEPT
# service iptables save